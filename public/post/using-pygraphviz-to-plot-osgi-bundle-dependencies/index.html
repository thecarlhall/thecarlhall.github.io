<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Using pygraphviz to plot OSGi bundle dependencies - Carlibrated!
</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=color-scheme content="light dark"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=generator content="Hugo 0.140.0"><link rel=canonical href=https://thecarlhall.github.io/post/using-pygraphviz-to-plot-osgi-bundle-dependencies/><meta name=author content="Carl Hall"><meta name=description content="I&rsquo;ve been working on an OSGi project for the last few years. As with any project, evolutionary changes will eventually require some cleanup. As new bundles have been added over time, the graph of dependencies is starting to get unwieldy in places. Even with good management of these dependencies, a nice visual layout of things can really help you see how your bundles are interconnected and give you the power to start separating some connections if you graph starts to hit cyclical dependencies.
"><meta name=keywords content="software,technology,development,management"><meta property="og:url" content="https://thecarlhall.github.io/post/using-pygraphviz-to-plot-osgi-bundle-dependencies/"><meta property="og:site_name" content="Carlibrated!"><meta property="og:title" content="Using pygraphviz to plot OSGi bundle dependencies"><meta property="og:description" content="I’ve been working on an OSGi project for the last few years. As with any project, evolutionary changes will eventually require some cleanup. As new bundles have been added over time, the graph of dependencies is starting to get unwieldy in places. Even with good management of these dependencies, a nice visual layout of things can really help you see how your bundles are interconnected and give you the power to start separating some connections if you graph starts to hit cyclical dependencies."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2011-09-05T00:00:00+00:00"><meta property="article:modified_time" content="2011-09-05T00:00:00+00:00"><meta itemprop=name content="Using pygraphviz to plot OSGi bundle dependencies"><meta itemprop=description content="I’ve been working on an OSGi project for the last few years. As with any project, evolutionary changes will eventually require some cleanup. As new bundles have been added over time, the graph of dependencies is starting to get unwieldy in places. Even with good management of these dependencies, a nice visual layout of things can really help you see how your bundles are interconnected and give you the power to start separating some connections if you graph starts to hit cyclical dependencies."><meta itemprop=datePublished content="2011-09-05T00:00:00+00:00"><meta itemprop=dateModified content="2011-09-05T00:00:00+00:00"><meta itemprop=wordCount content="632"><meta itemprop=keywords content="Development,Osgi"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using pygraphviz to plot OSGi bundle dependencies"><meta name=twitter:description content="I’ve been working on an OSGi project for the last few years. As with any project, evolutionary changes will eventually require some cleanup. As new bundles have been added over time, the graph of dependencies is starting to get unwieldy in places. Even with good management of these dependencies, a nice visual layout of things can really help you see how your bundles are interconnected and give you the power to start separating some connections if you graph starts to hit cyclical dependencies."><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/style.min.de488e0d4b09a0b9f6412192239661fda9bb9ea66e49d8f210bf0786a4e36acb.css integrity="sha256-3kiODUsJoLn2QSGSI5Zh/am7nqZuSdjyEL8HhqTjass=" media=screen crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><div class=carl-header><img src=/images/soon-cat.jpg alt="Header Image"></div><script>(function(){var e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script></head><body><div id=back-to-top></div><header class=site-header><div class=desktop-header><div class=desktop-header-logo><a href=/ class=logo>Carlibrated</a></div><nav class=desktop-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/>Home</a></li><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/post/>Posts</a></li><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/about/>About</a></li><li class=menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg><svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=menu-item><a class=menu-item-link href=https://thecarlhall.github.io/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div><div class=mobile-header><div id=mobile-navbar class=mobile-navbar><div id=mobile-navbar-icon class=mobile-navbar-icon><svg aria-hidden="true" class="lucide lucide-menu hi-svg-inline icon--menu" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg></div><div class=mobile-navbar-logo><a href=/ class=logo>Carlibrated</a></div></div><div id=mobile-menu-close-modal class=mobile-menu-close-modal></div><nav id=mobile-menu class=mobile-menu><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/>Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/post/>Posts</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/about/>About</a></li><li class=mobile-menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg><svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=mobile-menu-item><a class=menu-item-link href=https://thecarlhall.github.io/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div></header><main id=main class="main pico container"><div class=content-wrapper><aside class=sidebar></aside><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Using pygraphviz to plot OSGi bundle dependencies</h1><div class=post-meta-list><div class="post-meta-item post-meta-author"><svg aria-hidden="true" class="lucide lucide-user-round-pen hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M2 21a8 8 0 0110.821-7.487"/><path d="M21.378 16.626a1 1 0 00-3.004-3.004l-4.01 4.012a2 2 0 00-.506.854l-.837 2.87a.5.5.0 00.62.62l2.87-.837a2 2 0 00.854-.506z"/><circle cx="10" cy="8" r="5"/></svg>
<a href=/about><span class=post-meta-author-name>Carl Hall</span></a></div><div class="post-meta-item post-meta-time"><svg aria-hidden="true" class="lucide lucide-calendar-days hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
<time datetime=2011-09-05>2011-09-05</time></div><div class=post-meta__right><div class="post-meta-item post-meta-category"><a href=https://thecarlhall.github.io/categories/development/>development</a>
<a href=https://thecarlhall.github.io/categories/osgi/>osgi</a></div></div></div></header><div class=post-content><p>I&rsquo;ve been working on an OSGi project for the last few years. As with any project, evolutionary changes will eventually require some cleanup. As new bundles have been added over time, the graph of dependencies is starting to get unwieldy in places. Even with good management of these dependencies, a nice visual layout of things can really help you see how your bundles are interconnected and give you the power to start separating some connections if you graph starts to hit cyclical dependencies.</p><p>I drove around a few different visual tools in Eclipse (<a href=http://www.eclipse.org/pde/incubator/dependency-visualization/ title="PDE visualization tool">PDE visualization tool</a>, m2eclipse dependency graph) but needed something that would narrow the view to just my project. I not only wanted to see what things my bundles depend on in the project but I wanted to see what depends on a given bundle.</p><p>This was my first project with pygraphviz but after I figured out which way the grain runs, I was able to give it a basic graph of my project and generate the diagrams I wanted. I finally let pygraphviz handle the graph traversing and things got better (less code, faster results).</p><p>Since I wanted to analyze the runtime dependencies of my server, I installed the <a href=http://felix.apache.org/site/apache-felix-remote-shell.html title="Felix Remote Shell">Felix Remote Shell</a> bundle along with the <a href=http://felix.apache.org/site/apache-felix-shell.html title="Felix Shell">Felix Shell</a> bundle to allow remote connections to management functionality. With these in place, I was able to connect via telnet and query for package level information to build my graph.</p><p>Using the code below, I was able to generate a graph of the entire project (successors) and a graph for each bundle in the graph (predecessors and successors). Some sample images are below the source code. Eventually I&rsquo;ll add saving and opening of dot files to allow for analysis without a running server.</p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sets <span style=color:#f92672>import</span> Set
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pygraphviz <span style=color:#66d9ef>as</span> pgv
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> telnetlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># [   1] [Active     ] [   15] org.sakaiproject.nakamura.messaging (0.11.0.SNAPSHOT)</span>
</span></span><span style=display:flex><span>bundle_from_ps <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>&#39;^\[\s*(?P&amp;lt;bundle_id&amp;gt;\d+)\]\s\[.+\]\s(?P&amp;lt;bundle_name&amp;gt;.+)\s&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># org.sakaiproject.nakamura.api.solr; version=0.0.0 -&amp;gt; org.sakaiproject.nakamura.solr [11]</span>
</span></span><span style=display:flex><span>bundle_from_req <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>&#39;^.*-\&amp;gt; (?P&amp;lt;bundle_name&amp;gt;.*) \[(?P&amp;lt;bundle_id&amp;gt;.*)\]$&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_sakai_bundles</span>():
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;Get a list of bundles that are create <span style=color:#66d9ef>as</span> part of Sakai OAE<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>    Returns a dictionary of dict[bundle_name] <span style=color:#f92672>=</span> bundle_id<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;
</span></span><span style=display:flex><span>    tn <span style=color:#f92672>=</span> telnetlib<span style=color:#f92672>.</span>Telnet(<span style=color:#e6db74>&#39;localhost&#39;</span>, <span style=color:#e6db74>&#39;6666&#39;</span>)
</span></span><span style=display:flex><span>    tn<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;ps -s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>exit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    lines <span style=color:#f92672>=</span> [line <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> tn<span style=color:#f92672>.</span>read_all()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;org.sakaiproject&#39;</span> <span style=color:#f92672>in</span> line]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    bundles <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines:
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> bundle_from_ps<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(line)
</span></span><span style=display:flex><span>        bundles[m<span style=color:#f92672>.</span>group(<span style=color:#e6db74>&#39;bundle_name&#39;</span>)] <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>group(<span style=color:#e6db74>&#39;bundle_id&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bundles
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_package_reqs</span>(bundle_id):
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;Gets the requirements (imports) <span style=color:#66d9ef>for</span> a given bundle<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>    Returns a dictionary of dict[bundle_name] <span style=color:#f92672>=</span> bundle_id<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Keyword arguments:
</span></span><span style=display:flex><span>    bundle_id <span style=color:#f92672>--</span> Bundle ID returned by the server <span style=color:#f92672>in</span> the output of
</span></span><span style=display:flex><span>                 get_sakai_bundles()
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;
</span></span><span style=display:flex><span>    tn <span style=color:#f92672>=</span> telnetlib<span style=color:#f92672>.</span>Telnet(<span style=color:#e6db74>&#39;localhost&#39;</span>, <span style=color:#e6db74>&#39;6666&#39;</span>)
</span></span><span style=display:flex><span>    tn<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;inspect package requirement </span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>exit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> (bundle_id))
</span></span><span style=display:flex><span>    lines <span style=color:#f92672>=</span> [line <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> tn<span style=color:#f92672>.</span>read_all()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>if</span> line<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;org.sakaiproject&#39;</span>) <span style=color:#f92672>and</span> line<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#39;]&#39;</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    reqs <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines:
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> bundle_from_req<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(line)
</span></span><span style=display:flex><span>        reqs[m<span style=color:#f92672>.</span>group(<span style=color:#e6db74>&#39;bundle_name&#39;</span>)] <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>group(<span style=color:#e6db74>&#39;bundle_id&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> reqs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_bundle_graph</span>():
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;Build a graph_attr (nodes, edges) representing the connectivity
</span></span><span style=display:flex><span>    within Sakai bundles
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;
</span></span><span style=display:flex><span>    sakai_bundles <span style=color:#f92672>=</span> get_sakai_bundles()
</span></span><span style=display:flex><span>    bundles <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> b_name, b_id <span style=color:#f92672>in</span> sakai_bundles<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        reqs <span style=color:#f92672>=</span> get_package_reqs(b_id)
</span></span><span style=display:flex><span>        bundles[b_name] <span style=color:#f92672>=</span> reqs<span style=color:#f92672>.</span>keys()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bundles
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw_subgraph</span>(name, graph, filename, successors <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;Draw (write to disk) a subgraph that starts <span style=color:#66d9ef>with</span> <span style=color:#f92672>or</span> ends <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    the specified node<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Keyword arguments:
</span></span><span style=display:flex><span>    name <span style=color:#f92672>--</span> name of the node to focus on
</span></span><span style=display:flex><span>    graph <span style=color:#f92672>--</span> graph of paths between bundles
</span></span><span style=display:flex><span>    filename <span style=color:#f92672>--</span> filename to write subgraph to
</span></span><span style=display:flex><span>    successors <span style=color:#f92672>--</span> whether to lookup successors <span style=color:#f92672>or</span> predecessors
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;<span style=color:#f92672>&amp;</span>quot;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> successors:
</span></span><span style=display:flex><span>        nbunch <span style=color:#f92672>=</span> graph<span style=color:#f92672>.</span>successors(name)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        nbunch <span style=color:#f92672>=</span> graph<span style=color:#f92672>.</span>predecessors(name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> nbunch:
</span></span><span style=display:flex><span>        nbunch<span style=color:#f92672>.</span>append(name)
</span></span><span style=display:flex><span>        subgraph <span style=color:#f92672>=</span> graph<span style=color:#f92672>.</span>subgraph(nbunch)
</span></span><span style=display:flex><span>        subgraph<span style=color:#f92672>.</span>layout(prog <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;dot&#39;</span>)
</span></span><span style=display:flex><span>        subgraph<span style=color:#f92672>.</span>draw(<span style=color:#e6db74>&#39;graphviz/</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> filename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>isdir(<span style=color:#e6db74>&#39;graphviz&#39;</span>):
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>mkdir(<span style=color:#e6db74>&#39;graphviz&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    bundles_graph <span style=color:#f92672>=</span> build_bundle_graph()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># print the whole graph</span>
</span></span><span style=display:flex><span>    graph <span style=color:#f92672>=</span> pgv<span style=color:#f92672>.</span>AGraph(data <span style=color:#f92672>=</span> bundles_graph, directed <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    graph<span style=color:#f92672>.</span>layout(prog <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;dot&#39;</span>)
</span></span><span style=display:flex><span>    graph<span style=color:#f92672>.</span>draw(<span style=color:#e6db74>&#39;graphviz/org.sakaiproject.nakamura.png&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> b_name, reqs <span style=color:#f92672>in</span> bundles_graph<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        draw_subgraph(b_name, graph, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>.png&#39;</span> <span style=color:#f92672>%</span> b_name)
</span></span><span style=display:flex><span>        draw_subgraph(b_name, graph, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>-pred.png&#39;</span> <span style=color:#f92672>%</span> b_name, <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()</span></span></code></pre></div></div><figure><p><img src=/images/org-sakaiproject-nakamura.png alt="Sakai OAE Bundle Dependency Graph"></p><figcaption><p>Sakai OAE Bundle Dependency Graph</p></figcaption></figure><figure><p><img src=/images/org-sakaiproject-nakamura-solr-pred.png alt="Sakai OAE Solr Bundle Predecessors"></p><figcaption><p>Sakai OAE Solr Bundle Predecessors</p></figcaption></figure><figure><p><img src=/images/org-sakaiproject-nakamura-presence.png alt="Sakai OAE Presence Bundle Successors"></p><figcaption><p>Sakai OAE Presence Bundle Successors</p></figcaption></figure></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Carl Hall</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2011-09-05</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/understanding-the-unresolved-constraint-missing-resource-message-from-apache-felix/><i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-left hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m15 18-6-6 6-6"/></svg>
</i><span class="prev-text nav-default">Understanding the 'unresolved constraint', 'missing requirement' message from Apache Felix</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/committer-status-on-apache-sling/><span class="next-text nav-default">Committer Status on Apache Sling</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-right hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"/></svg></i></a></nav></footer></article></div></div></main><footer id=footer class=site-footer><div class=social-icon-links><a href=https://thecarlhall.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=social-icon-link title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span><span class=copyright-year>&copy;
2024
<span class=heart><i class=iconfont><svg aria-hidden="true" class="lucide lucide-heart hi-svg-inline" fill="none" height="1em" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5.0 0016.5 3c-1.76.0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5.0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7z"/></svg>
</i></span><span class=author>Carl Hall</span></span></div></footer><script type=text/javascript src=/js/main.22922b44c2472763db448ad18224b6dafba94e9de0a8d08b7542197bffebf023.js integrity="sha256-IpIrRMJHJ2PbRIrRgiS22vupTp3gqNCLdUIZe//r8CM=" crossorigin=anonymous></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script></body></html>